<!DOCTYPE html>
<html>
    <head>
        <!-- Required meta tags -->
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        
        <!-- Bootstrap CSS -->
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
         <link rel = "stylesheet" type = "text/css" href="css/voterlocationCSS.css">
        
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
        
        <!-- Website Title -->
        <title>Election Essentials</title>
        <!-- Website Image -->
        <link href="img/Logo.png" />
    </head>
    <body>
        <!-- Navigation Bar -->
        <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
            <a class="navbar-brand" href="homepage.html">
                <img src="img/Logo.png" width="40" height="40" alt="">
            </a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav mr-auto">
                    <li class="nav-item active">
                        <a class="nav-link" href="homepage.html">Home<span class="sr-only">(current)</span></a>
                    </li>
                    <li class="nav-item active">
                        <a class="nav-link" href="about.html">About<span class="sr-only">(current)</span></a>
                    </li>
                    <li class="nav-item active dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Account</a>
                        <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                            <a class="dropdown-item" href="youraccount.html">Create Account</a>
                            <a class="dropdown-item" href="login.html">Login</a>
                            <a class="dropdown-item" onclick="removeSessionData()">Logout</a>
                        </div>
                    </li>
                    <li class="nav-item active">
                        <a class="nav-link" href="candidates.html">Candidates<span class="sr-only">(current)</span></a>
                    </li>
                    <li class="nav-item active">
                        <a class="nav-link" href="voterinformation.html">Deadlines<span class="sr-only">(current)</span></a>
                    </li>
                    <li class="nav-item active">
                        <a class="nav-link" href="trendingissues.html">Issues<span class="sr-only">(current)</span></a>
                    </li>
                    <li class="nav-item active">
                        <a class="nav-link" href="voterlocation.html">Locations<span class="sr-only">(current)</span></a>
                    </li>
                    <li class="nav-item active">
                        <a class="nav-link" href="trendingnews.html">News<span class="sr-only">(current)</span></a>
                    </li>
                </ul>
            </div>
        </nav>
        
        <!-- Jumbotron -->
        <div class = "jumbotron">
            <div class = "container">
                <h1>Election Essentials: Registration and Voting Locations</h1>
            </div>
        </div>
        
        <!-- Search Jumbotron -->
        <div class = "search_jumbotron">
            <div class = "container">
                <p>Use your current location to look for registration and voting locations nearby.</p>
                <button onclick = "getLocation()">Current Location</button>
                <p>Use the search bar to look for registration and voting locations in a specific area. Please use the following format: 1234 Cool Street, City, State, Zip Code</p>
                <div class="searchbar">
                    <input class = "text-center" type="text" id = "searchInput" placeholder="Location">
                    <button id="go" onclick = "codeAddress()">Search</button>
                </div>
            </div>
        </div>
        
        <!--Google Map-->
        <div id = "googleMap"></div>
        
        <!-- List of Locations -->
        <table class="table" id = "tableB">
            <thead class="thead-dark">
                <tr>
                    <th scope="col">#</th>
                    <th scope="col">Location</th>
                </tr>
            </thead>
            <tbody id = "tableBody">
                <!-- Rows Dynamically Added Here -->
            </tbody>
        </table>
        
        <script>
            var geocoder;
            var map;
            
            //Initialize Map
            function initMap() 
            {                
                geocoder = new google.maps.Geocoder();
                //Location
                var latlng = new google.maps.LatLng(-25.344, 131.036);
                var mapOptions = {zoom: 7, center: latlng}
                //Map - Centered at Location
                map = new google.maps.Map(document.getElementById("googleMap"), mapOptions);
                //Marker - Position at Location
                var marker = new google.maps.Marker({position: latlng, map: map});
            }
            
            function getLocation() 
            {
                if (navigator.geolocation) 
                {
                    navigator.geolocation.getCurrentPosition(showPosition);
                } 
                else 
                {
                    alert("This browser does not support Geolocation");
                }
            }

            function showPosition(position) 
            {
                //Location
                var latlng = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);
                var mapOptions = {zoom: 7, center: latlng}
                //Map - Centered at Location
                map = new google.maps.Map(document.getElementById("googleMap"), mapOptions);
                //Marker - Position at Location
                var marker = new google.maps.Marker({position: latlng, map: map});
                
                
                
                //Reverse Geocoder - Find Address for Database Lookup
                geocoder.geocode({'location': latlng}, function(results, status) 
                {
                    if (status == google.maps.GeocoderStatus.OK) 
                    {
                        if (results[0]) 
                        {
                            //alert(results[0].formatted_address);/////////////////////////////////////////////////////////////////////////////////////////////
                        } 
                        else 
                        {
                            window.alert('No results found');
                        }
                    }
                });
            }
            
            function codeAddress()
            {
                //Clear Table
//                var table = $("#tableB");
//                var tableBody = document.getElementById("tableBody");
//                var newBody = document.createElement('tbody');
//                tableBody.parentNode.replaceChild(newBody, tableBody);
                
                //Location String
                var address = document.getElementById("searchInput").value;
                var addr = address;
                while(addr.includes(" ")) 
                {
  	                addr = addr.replace(" ", "%20");
                }
                var url = "http://database-env.tpry6djxqe.us-east-2.elasticbeanstalk.com/locations/" + addr;
                console.log("location = " + url);
                try 
                {
                    $.getJSON(url, function (data) 
                    {//gets JSON from the API server
                        var addresses = [];
                        for(var x = 0; x < data.length; x++) 
                        {
                            addresses.push(data[x]["address"]);
                        }
                        console.log(addresses);
                        
                        //Clear Table
                        var table = $("#tableB");
                        var tableBody = document.getElementById("tableBody");
                        var newBody = document.createElement('tbody');
                        tableBody.parentNode.replaceChild(newBody, tableBody);
                        
                        //Populates List
                        for (var index = 0; index < addresses.length; index++)
                        {
                            table.append("<tbody id = \"tableBody\"><tr><td>" + (index + 1) + "</td><td>" + addresses[index] + "</td></tr></tbody>");
                        }
                        
                        //Geocoder for Addresses returned from Database
                        for (var index = 0; index < addresses.length; index++)
                        {
                            geocoder.geocode({address: addresses[index]}, function(results, status)
                            {
                                if (status == google.maps.GeocoderStatus.OK)
                                {
                                    map.setCenter(results[0].geometry.location);
                                    var marker = new google.maps.Marker({position: results[0].geometry.location, map: map});

                                }
                                else
                                {
                                    //Error handling for Invalid Locations
                                }
                            });
                        }
                    });
                }
                catch (e) 
                {
                    alert("Please enter a valid Location");
                }
                //Geocoder fro Address Inputted
                geocoder.geocode({address: address}, function(results, status)
                {
                    if (status == google.maps.GeocoderStatus.OK)
                    {
                        map.setCenter(results[0].geometry.location);
                        var marker = new google.maps.Marker({position: results[0].geometry.location, map: map});

                    }
                    else
                    {
                        //Error handling for Invalid Locations
                        alert("Invalid Location");
                    }
                });
            }
            
//           
//             function removeSessionData()
//             {
//                 sessionStorage.clear();
//             }
        </script>
        
        <!-- Google Geolocation API -->
        <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAM6YVObOh5Fwv2Bw71ATMEC1KeMR8F_b4&callback=initMap"></script>

        <!-- Optional JavaScript -->
        <!-- jQuery first, then Popper.js, then Bootstrap JS -->
        <script src="js/youraccount.js" ></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
    </body>
</html>